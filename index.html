---
layout: default
title: Home
---
<div class="sections-view">
  {% assign tales = site.pages | where_exp:"p","p.url contains '/tales/'" %}

  <div class="grid">
    <!-- Tales / longform (preserved) -->
    <section class="col">
      <header class="col-header"><h2>üìù Tales from the Independent</h2></header>
      <ul class="col-list">
        {% assign list = tales | sort: 'path' | reverse %}
        {% for entry in list limit: 20 %}
          <li>
            <a class="card" href="{{ entry.url | relative_url }}">
              {% assign hero = entry.images | first %}
              <div class="card-media">
                {% if hero %}
                  {% assign _src = hero.src %}
                  {% assign first = _src | slice: 0, 1 %}
                  {% assign cleaned = _src | replace: './', '' %}
                  {% if _src contains '://' %}
                    {% assign resolved = _src %}
                  {% elsif first == '/' %}
                    {% assign resolved = _src %}
                  {% else %}
                    {% assign base = entry.path | replace: entry.name, '' %}
                    {% assign resolved = '/' | append: base | append: cleaned %}
                  {% endif %}
                  <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
                {% else %}
                  <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
                {% endif %}
              </div>
              <div class="card-body">
                <h3 class="card-title">{{ entry.title }}</h3>
                <p class="card-meta">
                  <time>{% include date.html doc=entry format="%b %-d, %Y" %}</time>
                </p>
                {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>

    {% comment %}
      Shortform sections by folder.
      Labels:
        events:     Events Notice
        management: From the Management
        lostnfound: Lost & Found
        safety:     Safety Tips for Long Lives
        style:      Style & Grace
        visions:    Visions of Independent Living
    {% endcomment %}

    {% assign section_defs = "Events Notice:events|From the Management:management|Lost & Found:lostnfound|Safety Tips for Long Lives:safety|Style & Grace:style|Visions of Independent Living:visions" | split:"|" %}

    {% for s in section_defs %}
      {% assign pair = s | split: ":" %}
      {% assign label = pair[0] %}
      {% assign slug  = pair[1] %}

      {% if slug == 'events' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/events/'" %}
      {% elsif slug == 'management' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/management/'" %}
      {% elsif slug == 'lostnfound' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/lostnfound/'" %}
      {% elsif slug == 'safety' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/safety/'" %}
      {% elsif slug == 'style' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/style/'" %}
      {% elsif slug == 'visions' %}
        {% assign collection = site.pages | where_exp:"p","p.url contains '/visions/'" %}
      {% endif %}

      <section class="col">
        <header class="col-header"><h2>{{ label }}</h2></header>
        <ul class="col-list">
          {% if slug == 'events' %}
            {% assign list = collection | sort: 'starts_at' %}
          {% else %}
            {% assign list = collection | sort: 'path' | reverse %}
          {% endif %}

          {% for entry in list limit: 20 %}
            <li>
              <a class="card card-compact" href="{{ entry.url | relative_url }}">
                {% assign hero = entry.images | first %}
                <div class="card-media">
                  {% if hero %}
                    {% assign _src = hero.src %}
                    {% assign first = _src | slice: 0, 1 %}
                    {% assign cleaned = _src | replace: './', '' %}
                    {% if _src contains '://' %}
                      {% assign resolved = _src %}
                    {% elsif first == '/' %}
                      {% assign resolved = _src %}
                    {% else %}
                      {% assign base = entry.path | replace: entry.name, '' %}
                      {% assign resolved = '/' | append: base | append: cleaned %}
                    {% endif %}
                    <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
                  {% else %}
                    <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
                  {% endif %}
                </div>
                <div class="card-body">
                  <h3 class="card-title">{{ entry.title }}</h3>
                  <p class="card-meta">
                    <time>
                      {% capture fmt %}{% if entry.section == 'events' and entry.starts_at %}%b %-d, %Y ‚Ä¢ %l:%M %P{% else %}%b %-d, %Y{% endif %}{% endcapture %}
                      {% include date.html doc=entry format=fmt %}
                    </time>
                    {% if entry.location and slug == 'events' %} ¬∑ {{ entry.location }}{% endif %}
                  </p>
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endfor %}
  </div>
</div>

<!-- Timeline (newest ‚Üí oldest) without Liquid object sort -->
<div class="timeline-view">
  {% assign tales      = site.pages | where_exp:"p","p.url contains '/tales/'" %}
  {% assign events     = site.pages | where_exp:"p","p.url contains '/events/'" %}
  {% assign management = site.pages | where_exp:"p","p.url contains '/management/'" %}
  {% assign lostnfound = site.pages | where_exp:"p","p.url contains '/lostnfound/'" %}
  {% assign safety     = site.pages | where_exp:"p","p.url contains '/safety/'" %}
  {% assign style      = site.pages | where_exp:"p","p.url contains '/style/'" %}
  {% assign visions    = site.pages | where_exp:"p","p.url contains '/visions/'" %}

  {% assign all = tales | concat: events | concat: management | concat: lostnfound | concat: safety | concat: style | concat: visions %}

  {% capture _rows %}
  {% for entry in all %}
    {% if entry.date %}
      {% assign ts = entry.date | date: '%s' %}
      {% capture li %}
      <li class="tl-item">
        <a class="card" href="{{ entry.url | relative_url }}">
          {% assign hero = entry.images | first %}
          <div class="card-media">
            {% if hero %}
              {% assign _src = hero.src %}
              {% assign first = _src | slice: 0, 1 %}
              {% assign cleaned = _src | replace: './', '' %}
              {% if _src contains '://' %}
                {% assign resolved = _src %}
              {% elsif first == '/' %}
                {% assign resolved = _src %}
              {% else %}
                {% assign base = entry.path | replace: entry.name, '' %}
                {% assign resolved = '/' | append: base | append: cleaned %}
              {% endif %}
              <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
            {% else %}
              <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
            {% endif %}
          </div>
          <div class="card-body">
            <h3 class="card-title">{{ entry.title }}</h3>
            <p class="card-meta">
              <time>{% include date.html doc=entry format="%b %-d, %Y" %}</time>
              {% if entry.section %} ¬∑ {{ entry.section }}{% endif %}
            </p>
            {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
          </div>
        </a>
      </li>
      {% endcapture %}
      {{ ts }}|||{{ entry.url }}|||{{ li | strip_newlines }}{{ '
' }}
    {% endif %}
  {% endfor %}
  {% endcapture %}

  {% assign lines  = _rows | split: '
' | compact %}
  {% assign sorted = lines | sort | reverse %}

  <script>
    (function(){
      try {
        var rows = {{ sorted | jsonify }};
        var out = rows.map(function(s){
          var p = s.split("|||");
          return { ts: Number(p[0]), url: p[1] };
        });
        console.groupCollapsed("Timeline (newest ‚Üí oldest), using entry.date");
        console.table(out);
        console.groupEnd();
        window.__timelineDebug = out;
      } catch(e) { console.warn("Timeline debug failed:", e); }
    })();
  </script>

  <ul class="timeline-list">
    {% for row in sorted limit:60 %}
      {% assign parts = row | split:'|||' %}
      {{ parts[2] }}
    {% endfor %}
  </ul>

  {% comment %} Friendly errors for pages missing date {% endcomment %}
  {% assign invalid = all | where_exp:"p","p.date == nil" %}
  {% if invalid and invalid.size > 0 %}
    <div class="timeline-errors">
      <h3>Missing dates</h3>
      <p>Add <code>date: YYYY-MM-DD</code> to the front-matter of these pages:</p>
      <ul>
        {% for e in invalid %}
          <li><a href="{{ e.url | relative_url }}">{{ e.title | default: e.url }}</a></li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</div>
