---
layout: default
title: Home
---

<div class="sections-view">
  {% assign tales = site.pages | where_exp:"p","p.url contains '/tales/'" %}

  <div class="grid">
    <!-- Tales / longform (preserved) -->
    <section class="col">
      <header class="col-header"><h2>üìù Tales from the Independent</h2></header>
      <ul class="col-list">
        {% assign list = tales | sort: 'path' | reverse %}
        {% for entry in list limit: 20 %}
          <li>
            <a class="card" href="{{ entry.url | relative_url }}">
              {% assign hero = entry.images | first %}
              <div class="card-media">
                {% if hero %}
                  {% assign _src = hero.src %}
                  {% assign first = _src | slice: 0, 1 %}
                  {% assign cleaned = _src | replace: './', '' %}
                  {% if _src contains '://' %}
                    {% assign resolved = _src %}
                  {% elsif first == '/' %}
                    {% assign resolved = _src %}
                  {% else %}
                    {% assign base = entry.path | replace: entry.name, '' %}
                    {% assign resolved = '/' | append: base | append: cleaned %}
                  {% endif %}
                  <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
                {% else %}
                  <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
                {% endif %}
              </div>
              <div class="card-body">
                <h3 class="card-title">{{ entry.title }}</h3>
                <p class="card-meta">
                  <time>{% include date.html doc=entry format="%b %-d, %Y" %}</time>
                </p>
                {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>

    {%- comment -%}
      Shortform sections are driven from _config.yml ‚Üí site.sections
      We exclude 'tales' here since it‚Äôs rendered above.
    {%- endcomment -%}
    {% assign short_sections = site.sections | where_exp: "s", "s.slug != 'tales'" %}

    {% for s in short_sections %}
      {% assign label = s.label %}
      {% assign slug  = s.slug %}

      {% assign collection = site.pages | where: "section", slug %}
      {% if slug == 'events' %}
        {% assign list = collection | sort: 'starts_at' %}
      {% else %}
        {% assign list = collection | sort: 'path' | reverse %}
      {% endif %}

      <section class="col">
        <header class="col-header"><h2>{{ label }}</h2></header>
        <ul class="col-list">
          {% for entry in list limit: 20 %}
            <li>
              <a class="card card-compact" href="{{ entry.url | relative_url }}">
                {% assign hero = entry.images | first %}
                <div class="card-media">
                  {% if hero %}
                    {% assign _src = hero.src %}
                    {% assign first = _src | slice: 0, 1 %}
                    {% assign cleaned = _src | replace: './', '' %}
                    {% if _src contains '://' %}
                      {% assign resolved = _src %}
                    {% elsif first == '/' %}
                      {% assign resolved = _src %}
                    {% else %}
                      {% assign base = entry.path | replace: entry.name, '' %}
                      {% assign resolved = '/' | append: base | append: cleaned %}
                    {% endif %}
                    <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
                  {% else %}
                    <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
                  {% endif %}
                </div>
                <div class="card-body">
                  <h3 class="card-title">{{ entry.title }}</h3>
                  <p class="card-meta">
                    <time>
                      {% capture fmt %}
                        {% if slug == 'events' and entry.starts_at %}
                          %b %-d, %Y ‚Ä¢ %l:%M %P
                        {% else %}
                          %b %-d, %Y
                        {% endif %}
                      {% endcapture %}
                      {% include date.html doc=entry format=fmt %}
                    </time>
                    {% if entry.location and slug == 'events' %} ¬∑ {{ entry.location }}{% endif %}
                  </p>
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endfor %}
  </div>
</div>

<!-- Timeline (newest ‚Üí oldest) without Liquid object sort -->
<div class="timeline-view">
  {% assign entries = site.pages | where:"layout","entry" %}

  {% capture _rows %}
  {% for entry in entries %}
    {% if entry.date %}
      {% assign ts = entry.date | date: '%s' %}

      {% assign sec_slug = entry.section | to_s | strip | downcase %}
      {% assign sec_obj  = site.sections | where:"slug", sec_slug | first %}
      {% if sec_obj == blank %}
        {% assign sec_obj = site.sections[sec_slug] %}
      {% endif %}
      {% if sec_obj %}
        {% if sec_obj.label %}
          {% assign sec_label = sec_obj.label %}
        {% else %}
          {% assign sec_label = sec_obj %}
        {% endif %}
      {% else %}
        {% assign sec_label = sec_slug | replace:'-',' ' %}
      {% endif %}

      {% capture li %}
      <li class="tl-item">
        <a class="card" href="{{ entry.url | relative_url }}">
          {% assign hero = entry.images | first %}
          <div class="card-media">
            {% if hero %}
              {% assign _src = hero.src %}
              {% assign first = _src | slice: 0, 1 %}
              {% assign cleaned = _src | replace: './', '' %}
              {% if _src contains '://' %}
                {% assign resolved = _src %}
              {% elsif first == '/' %}
                {% assign resolved = _src %}
              {% else %}
                {% assign base = entry.path | replace: entry.name, '' %}
                {% assign resolved = '/' | append: base | append: cleaned %}
              {% endif %}
              <img src="{{ resolved | relative_url }}" alt="{{ hero.alt | default: '' }}">
            {% else %}
              <img src="{{ '/assets/placeholders/placeholder_card_400x300.png' | relative_url }}" alt="">
            {% endif %}
          </div>
          <div class="card-body">
            {% if sec_slug != '' %}
              <h6 class="card-section">{{ sec_label | upcase }}</h6>
            {% endif %}
            <h3 class="card-title">{{ entry.title }}</h3>
            <p class="card-meta">
              <time>{% include date.html doc=entry format="%b %-d, %Y" %}</time>
              {% if sec_slug != '' %} ¬∑ {{ sec_label }}{% endif %}
            </p>
            {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
          </div>
        </a>
      </li>
      {% endcapture %}
      {{ ts }}|||{{ entry.url }}|||{{ li | strip_newlines }}{{ '
' }}
    {% endif %}
  {% endfor %}
  {% endcapture %}

  {% assign lines  = _rows | split: '
' | compact %}
  {% assign sorted = lines | sort | reverse %}

  <script>
    (function(){
      try {
        var rows = {{ sorted | jsonify }};
        var out = rows.map(function(s){
          var p = s.split("|||");
          return { ts: Number(p[0]), url: p[1] };
        });
        console.groupCollapsed("Timeline (newest ‚Üí oldest), using entry.date");
        console.table(out);
        console.groupEnd();
        window.__timelineDebug = out;
      } catch(e) { console.warn("Timeline debug failed:", e); }
    })();
  </script>

  <ul class="timeline-list">
    {% for row in sorted limit:60 %}
      {% assign parts = row | split:'|||' %}
      {{ parts[2] }}
    {% endfor %}
  </ul>

  {% assign invalid = entries | where_exp:"p","p.date == nil" %}
  {% if invalid and invalid.size > 0 %}
    <div class="timeline-errors">
      <h3>Missing dates</h3>
      <p>Add <code>date: YYYY-MM-DD</code> to the front-matter of these pages:</p>
      <ul>
        {% for e in invalid %}
          <li><a href="{{ e.url | relative_url }}">{{ e.title | default: e.url }}</a></li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</div>
