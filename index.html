---
layout: default
title: Home
---

<div class="sections-view">
  {% assign tales = site.pages | where_exp:"p","p.url contains '/tales/'" %}
  {% assign default_card_format = site.date_formats.card_default | default: "%b %-d, %Y" %}
  {% assign default_entry_format = site.date_formats.entry_default | default: "%b %-d, %Y" %}
  {% assign tales_section = site.sections | where: "slug", "tales" | first %}
  {% assign tales_sort_key = 'path' %}
  {% assign tales_sort_direction = 'desc' %}
  {% if tales_section and tales_section.sort %}
    {% if tales_section.sort.key %}{% assign tales_sort_key = tales_section.sort.key %}{% endif %}
    {% if tales_section.sort.direction %}{% assign tales_sort_direction = tales_section.sort.direction %}{% endif %}
  {% endif %}
  {% assign tales_list = tales | sort: tales_sort_key %}
  {% assign tales_direction = tales_sort_direction | to_s | downcase | strip %}
  {% if tales_direction == 'desc' %}
    {% assign tales_list = tales_list | reverse %}
  {% endif %}
  {% assign tales_card_settings = nil %}
  {% if tales_section and tales_section.card %}
    {% assign tales_card_settings = tales_section.card %}
  {% endif %}

  <div class="grid">
    <!-- Tales / longform (preserved) -->
    <section class="col">
      <header class="col-header"><h2>üìù Tales from the Independent</h2></header>
      <ul class="col-list">
        {% for entry in tales_list limit: 20 %}
          <li>
            <a class="card" href="{{ entry.url | relative_url }}">
              {% assign hero = entry.images | first %}
              {% include card_media.html image=hero item=entry %}
              <div class="card-body">
                <h3 class="card-title">{{ entry.title }}</h3>
                <p class="card-meta">
                  {% capture card_fmt -%}{% include resolve_date_format.html settings=tales_card_settings doc=entry default=default_card_format %}{%- endcapture %}
                  <time>{% include date.html doc=entry format=card_fmt %}</time>
                </p>
                {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>

    {%- comment -%}
      Shortform sections are driven from _config.yml ‚Üí site.sections
      We exclude 'tales' here since it‚Äôs rendered above.
    {%- endcomment -%}
    {% assign short_sections = site.sections | where_exp: "s", "s.slug != 'tales'" %}

    {% for s in short_sections %}
      {% assign label = s.label %}
      {% assign slug  = s.slug %}

      {% assign collection = site.pages | where: "section", slug %}
      {% assign sort_key = 'path' %}
      {% assign sort_direction = 'desc' %}
      {% if s.sort %}
        {% if s.sort.key %}{% assign sort_key = s.sort.key %}{% endif %}
        {% if s.sort.direction %}{% assign sort_direction = s.sort.direction %}{% endif %}
      {% endif %}
      {% assign list = collection | sort: sort_key %}
      {% assign normalized_direction = sort_direction | to_s | downcase | strip %}
      {% if normalized_direction == 'desc' %}
        {% assign list = list | reverse %}
      {% endif %}
      {% assign card_settings = s.card %}

      <section class="col">
        <header class="col-header"><h2>{{ label }}</h2></header>
        <ul class="col-list">
          {% for entry in list limit: 20 %}
            <li>
              <a class="card card-compact" href="{{ entry.url | relative_url }}">
                {% assign hero = entry.images | first %}
                {% include card_media.html image=hero item=entry %}
                <div class="card-body">
                  <h3 class="card-title">{{ entry.title }}</h3>
                  <p class="card-meta">
                    {% capture card_fmt -%}{% include resolve_date_format.html settings=card_settings doc=entry default=default_card_format %}{%- endcapture %}
                    <time>{% include date.html doc=entry format=card_fmt %}</time>
                    {% if card_settings.show_location and entry.location %} ¬∑ {{ entry.location }}{% endif %}
                  </p>
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endfor %}
  </div>
</div>

<!-- Timeline (newest ‚Üí oldest) without Liquid object sort -->
<div class="timeline-view">
  {% assign entries = site.pages | where:"layout","entry" %}

  {% capture _rows %}
  {% for entry in entries %}
    {% if entry.date %}
      {% assign ts = entry.date | date: '%s' %}

      {% assign sec_slug = entry.section | to_s | strip | downcase %}
      {% assign sec_obj  = site.sections | where:"slug", sec_slug | first %}
      {% if sec_obj == blank %}
        {% assign sec_obj = site.sections[sec_slug] %}
      {% endif %}
      {% if sec_obj %}
        {% if sec_obj.label %}
          {% assign sec_label = sec_obj.label %}
        {% else %}
          {% assign sec_label = sec_obj %}
        {% endif %}
      {% else %}
        {% assign sec_label = sec_slug | replace:'-',' ' %}
      {% endif %}

      {% capture li %}
      <li class="tl-item">
        <a class="card" href="{{ entry.url | relative_url }}">
          {% assign hero = entry.images | first %}
          {% include card_media.html image=hero item=entry %}
          <div class="card-body">
            {% if sec_slug != '' %}
              <h6 class="card-section">{{ sec_label | upcase }}</h6>
            {% endif %}
            <h3 class="card-title">{{ entry.title }}</h3>
            <p class="card-meta">
              {% assign entry_settings = nil %}
              {% if sec_obj and sec_obj.entry %}
                {% assign entry_settings = sec_obj.entry %}
              {% endif %}
              {% capture entry_fmt -%}{% include resolve_date_format.html settings=entry_settings doc=entry default=default_entry_format %}{%- endcapture %}
              <time>{% include date.html doc=entry format=entry_fmt %}</time>
              {% if sec_slug != '' %} ¬∑ {{ sec_label }}{% endif %}
            </p>
            {% if entry.summary %}<p class="card-summary">{{ entry.summary }}</p>{% endif %}
          </div>
        </a>
      </li>
      {% endcapture %}
      {{ ts }}|||{{ entry.url }}|||{{ li | strip_newlines }}{{ '
' }}
    {% endif %}
  {% endfor %}
  {% endcapture %}

  {% assign lines  = _rows | split: '
' | compact %}
  {% assign sorted = lines | sort | reverse %}

  <script>
    (function(){
      try {
        var rows = {{ sorted | jsonify }};
        var out = rows.map(function(s){
          var p = s.split("|||");
          return { ts: Number(p[0]), url: p[1] };
        });
        console.groupCollapsed("Timeline (newest ‚Üí oldest), using entry.date");
        console.table(out);
        console.groupEnd();
        window.__timelineDebug = out;
      } catch(e) { console.warn("Timeline debug failed:", e); }
    })();
  </script>

  <ul class="timeline-list">
    {% for row in sorted limit:60 %}
      {% assign parts = row | split:'|||' %}
      {{ parts[2] }}
    {% endfor %}
  </ul>

  {% assign invalid = entries | where_exp:"p","p.date == nil" %}
  {% if invalid and invalid.size > 0 %}
    <div class="timeline-errors">
      <h3>Missing dates</h3>
      <p>Add <code>date: YYYY-MM-DD</code> to the front-matter of these pages:</p>
      <ul>
        {% for e in invalid %}
          <li><a href="{{ e.url | relative_url }}">{{ e.title | default: e.url }}</a></li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</div>
